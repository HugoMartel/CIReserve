<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: request.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: request.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Main page of the project, start the webserver by executing it
 * @author CIReserve
 * @version 1.0.0
 */

 const fs = require("fs");
 const { validationResult } = require('express-validator');

/**
 * Process the POST and GET requests from the express app in index.js
 * @type {Object}
 * @return {Object} functions to use with the Request module
 * @name Request
 * @namespace Request
 */
const Request = (function() {
    /**
    * @function AppRequest.testFunc
    * @param {Object} request
    * user's request
    * @param {Object} response
    * server's response
    * @returns {} /
    * @description POST request handler for an user registration to the site
    */
     let registerAccountCall = (req, res) => {
        const errors = validationResult(req);

        if (!errors.isEmpty()) {
          console.log(errors);
          return res.status(400).json({ errors: errors.array() });
        } else {
          //Get XMLHttpRequests values
          let passwordChecked = req.body.password;
          let usernameChecked = escape(req.body.username.trim());

          // Check if the credentials are correct
          if (
            usernameChecked.length > 3 &amp;&amp;
            passwordChecked.length > 8 &amp;&amp;
            /[0-9]/.test(passwordChecked) &amp;&amp;
            /[A-Z]/.test(passwordChecked) &amp;&amp;
            /[a-z]/.test(passwordChecked)
          ) {
            db.find(emailChecked, (username) => {
              if (username === undefined) {
                //Connection successful and the user doesn't already exist
                db.register(
                  emailChecked,
                  sha256(passwordChecked),
                  usernameChecked,
                  (affectedRows) => {
                    if (affectedRows === 1) {
                      //User addition successful -> fill the session values
                      req.session.username = usernameChecked;
                      req.session.login = emailChecked;
                      req.session.save();
                      res.json({ redirect: "/" });
                    } else {
                      //User addition unsuccessful
                      console.log("Error while adding an user to the DB...");
                      res.json({
                        error: "Error while adding an user to the DB...",
                      });
                    }
                  }
                );
              } else {
                //User can't be registered because his email is already in use
                console.log("Email already in use...");
                res.json({ error: "Email already in use..." });
              }
            });
          } else {
            console.log("Wrong logins credentials...");
            res.json({ error: "Wrong logins credentials..." });
          }
        }
      };

   /*
    function exempleFuncCall() {
        let fileSend = fs.readFileSync("front/html/head.html");
        //DO THINGS
        res.send(fileSend);
    }
    */
    return {
        //exempleFunc: (req, res) => exempleFuncCall(raq, res),
    };
})();

module.exports = { Request };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Request.html">Request</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Jan 10 2022 16:54:32 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
